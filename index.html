<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Cafe-AR | Premium MenÃ¼</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; font-family: 'Inter', sans-serif; background: #0a0a0a; color: white; display: flex; flex-direction: column; height: 100vh; }
        
        /* Ãœst Bar */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: rgba(0,0,0,0.8); border-bottom: 1px solid rgba(255,255,255,0.1); z-index: 20; }
        .brand { font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 800; color: #d4af37; letter-spacing: 1px; }
        .cart-btn { background: #d4af37; color: black; font-weight: 800; padding: 8px 16px; border-radius: 20px; cursor: pointer; display: flex; align-items: center; gap: 5px; }

        /* Ãœst KÄ±sÄ±m: 3D AR Sahnesi */
        .ar-container { flex: 1; position: relative; background: #111; }
        model-viewer { width: 100%; height: 100%; outline: none; --poster-color: transparent; }
        
        /* Åžov Butonu */
        .ar-overlay { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 10; width: 90%; max-width: 350px; }
        .btn-ar { background: linear-gradient(135deg, #d4af37 0%, #aa8c2c 100%); color: black; font-weight: 800; font-size: 15px; padding: 16px; border-radius: 16px; width: 100%; border: none; cursor: pointer; box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3); display: flex; justify-content: center; align-items: center; gap: 8px; }

        /* Alt KÄ±sÄ±m: SipariÅŸ Listesi (Scrollable) */
        .menu-list-container { height: 45vh; background: #151515; border-top: 1px solid rgba(255,255,255,0.1); overflow-y: auto; padding: 15px; padding-bottom: 50px; z-index: 20; }
        .menu-item { display: flex; align-items: center; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); padding: 12px; border-radius: 16px; margin-bottom: 12px; }
        .menu-item img { width: 70px; height: 70px; object-fit: cover; border-radius: 12px; margin-right: 15px; }
        .menu-info { flex: 1; }
        .menu-info h4 { margin: 0 0 5px 0; font-family: 'Playfair Display', serif; font-size: 17px; color: white; }
        .menu-info p { margin: 0; font-size: 15px; font-weight: 800; color: #d4af37; }
        .btn-add { background: rgba(212, 175, 55, 0.15); color: #d4af37; border: none; padding: 10px 15px; border-radius: 12px; font-weight: 800; font-size: 12px; cursor: pointer; transition: 0.2s; }
        .btn-add:active { background: #d4af37; color: black; }

        /* Sepet ModalÄ± */
        #cartModal { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.95); z-index: 100; display: none; flex-direction: column; padding: 20px; box-sizing: border-box; backdrop-filter: blur(10px); }
        .cart-header { display: flex; justify-content: space-between; align-items: center; font-family: 'Playfair Display', serif; font-size: 24px; color: #d4af37; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; margin-top: 20px; margin-bottom: 15px; }
        .close-cart { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        #cartItems { flex: 1; overflow-y: auto; }
        .cart-item-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; margin-bottom: 10px; }
        .cart-total { font-size: 24px; font-weight: 800; text-align: right; margin: 20px 0; color: #d4af37; }
        .btn-order { background: #d4af37; color: black; font-weight: 800; padding: 18px; border-radius: 16px; border: none; width: 100%; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <div class="brand">THE RESTAURANT</div>
        <div class="cart-btn" onclick="sepetiAc()">
            ðŸ›’ Sepet (<span id="cartCount">0</span>)
        </div>
    </div>

    <div class="ar-container">
        <model-viewer id="ar-gosterici"
            src="https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/BoxTextured/glTF-Binary/BoxTextured.glb"
            ar ar-modes="webxr scene-viewer quick-look"
            camera-controls 
            ar-placement="floor"
            scale="0.8 0.01 1.2"
            shadow-intensity="1.5"
            shadow-softness="1">
            <button slot="ar-button" style="display: none;"></button>
        </model-viewer>

        <div class="ar-overlay">
            <button class="btn-ar" onclick="document.getElementById('ar-gosterici').activateAR()">
                ðŸ“¸ Masadaki MenÃ¼yÃ¼ GÃ¶r
            </button>
        </div>
    </div>

    <div class="menu-list-container" id="menuList">
        <p style="text-align: center; color: #666; margin-top: 20px;">MenÃ¼ YÃ¼kleniyor...</p>
    </div>

    <div id="cartModal">
        <div class="cart-header">
            <span>Adisyonunuz</span>
            <button class="close-cart" onclick="sepetiKapat()">âœ•</button>
        </div>
        <div id="cartItems"></div>
        <div class="cart-total">Toplam: <span id="totalPrice">0</span> â‚º</div>
        <button class="btn-order" onclick="siparisGonder()">SipariÅŸi Onayla</button>
    </div>

    <script>
        const KULLANICI = "fthlabz";
        const REPO = "cafe-ar"; 
        
        let menuVerisi = [];
        let sepet = [];

        async function sistemiBaslat() {
            try {
                const cevap = await fetch(`https://raw.githubusercontent.com/${KULLANICI}/${REPO}/main/menu.json?t=${Date.now()}`);
                if (cevap.ok) {
                    menuVerisi = await cevap.json();
                    
                    // 1. Matbaa baskÄ±sÄ± gibi AR MenÃ¼yÃ¼ Ã§iz
                    await arKartiCiz(menuVerisi);
                    
                    // 2. SipariÅŸ verilecek listeyi Ã§iz
                    siparisListesiniCiz(menuVerisi);
                }
            } catch (e) { document.getElementById('menuList').innerHTML = "<p style='text-align:center;'>MenÃ¼ henÃ¼z boÅŸ.</p>"; }
        }

        // --- DEV PROJE: DÄ°NAMÄ°K MENÃœ BASKISI (CANVAS RENDERER) ---
        // Bu kod havada asÄ±lÄ± aslanÄ± yok eder. MenÃ¼yÃ¼ masaya kalÄ±cÄ± boyar.
        async function arKartiCiz(veriler) {
            const canvas = document.createElement('canvas');
            canvas.width = 1024;
            canvas.height = 1536; // DikdÃ¶rtgen boyut
            const ctx = canvas.getContext('2d');

            // Zemin Rengi (ÅžÄ±k Mat Siyah)
            ctx.fillStyle = '#111111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // AltÄ±n Ã‡erÃ§eve
            ctx.strokeStyle = '#d4af37';
            ctx.lineWidth = 15;
            ctx.strokeRect(30, 30, canvas.width - 60, canvas.height - 60);

            // BaÅŸlÄ±k
            ctx.fillStyle = '#d4af37';
            ctx.font = 'bold 90px "Playfair Display", serif';
            ctx.textAlign = 'center';
            ctx.fillText('MENÃœ', canvas.width / 2, 160);

            // Ã‡izgi
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2 - 150, 200);
            ctx.lineTo(canvas.width / 2 + 150, 200);
            ctx.stroke();

            // Yemekleri Alt Alta YazdÄ±r
            let y = 350;
            veriler.forEach(urun => {
                // Yemek AdÄ±
                ctx.fillStyle = '#ffffff';
                ctx.font = '50px Inter';
                ctx.textAlign = 'left';
                ctx.fillText(urun.ad, 100, y);

                // FiyatÄ± (Nokta nokta boÅŸluk bÄ±rakÄ±p saÄŸa yasla)
                ctx.fillStyle = '#d4af37';
                ctx.font = 'bold 50px Inter';
                ctx.textAlign = 'right';
                ctx.fillText(urun.fiyat + ' â‚º', canvas.width - 100, y);

                y += 100; // Bir sonraki yemek iÃ§in aÅŸaÄŸÄ± in
            });

            // Afiyet Olsun YazÄ±sÄ±
            ctx.fillStyle = '#555';
            ctx.font = 'italic 30px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('Afiyet Olsun...', canvas.width / 2, canvas.height - 100);

            // Canvas'Ä± resme Ã§evir ve 3D objeye kapla
            const textureUrl = canvas.toDataURL('image/jpeg', 0.9);
            const mv = document.getElementById('ar-gosterici');
            
            // Model Viewer'Ä±n kaplama fonksiyonunun hazÄ±r olmasÄ±nÄ± bekle
            await new Promise(r => setTimeout(r, 200)); 
            if (mv.model && mv.model.materials) {
                const texture = await mv.createTexture(textureUrl);
                const material = mv.model.materials[0];
                material.pbrMetallicRoughness.baseColorTexture.setTexture(texture);
                material.pbrMetallicRoughness.setBaseColorFactor([1, 1, 1, 1]);
            }
        }

        // --- SÄ°PARÄ°Åž LÄ°STESÄ° (Sade Web UX) ---
        function siparisListesiniCiz(veriler) {
            const listDiv = document.getElementById('menuList');
            listDiv.innerHTML = "";

            veriler.forEach((urun) => {
                listDiv.innerHTML += `
                    <div class="menu-item">
                        <img src="${urun.resim}">
                        <div class="menu-info">
                            <h4>${urun.ad}</h4>
                            <p>${urun.fiyat} â‚º</p>
                        </div>
                        <button class="btn-add" onclick='sepeteEkle(${JSON.stringify(urun).replace(/'/g, "&#39;")})'>EKLE</button>
                    </div>
                `;
            });
        }

        function sepeteEkle(urun) {
            if (navigator.vibrate) navigator.vibrate(50);
            sepet.push(urun);
            
            const cartBtn = document.querySelector('.cart-btn');
            cartBtn.style.transform = "scale(1.1)";
            setTimeout(() => cartBtn.style.transform = "scale(1)", 200);
            
            document.getElementById('cartCount').innerText = sepet.length;
        }

        function sepetiAc() {
            const modal = document.getElementById('cartModal');
            const itemsDiv = document.getElementById('cartItems');
            let toplam = 0;
            
            itemsDiv.innerHTML = "";
            
            if(sepet.length === 0) {
                itemsDiv.innerHTML = "<p style='text-align:center; color:#888; margin-top:50px;'>Adisyonunuz henÃ¼z boÅŸ.</p>";
            } else {
                sepet.forEach((urun, index) => {
                    toplam += parseFloat(urun.fiyat);
                    itemsDiv.innerHTML += `
                        <div class="cart-item-row">
                            <div>
                                <div style="font-weight:600; font-size:18px;">${urun.ad}</div>
                                <div style="font-size:15px; color:#d4af37; margin-top:4px;">${urun.fiyat} â‚º</div>
                            </div>
                            <button class="close-cart" style="color:#ef4444; font-size:28px;" onclick="sepettenCikar(${index})">Ã—</button>
                        </div>
                    `;
                });
            }
            
            document.getElementById('totalPrice').innerText = toplam;
            modal.style.display = 'flex';
        }

        function sepettenCikar(index) {
            sepet.splice(index, 1);
            document.getElementById('cartCount').innerText = sepet.length;
            sepetiAc(); 
        }

        function sepetiKapat() {
            document.getElementById('cartModal').style.display = 'none';
        }

        function siparisGonder() {
            if(sepet.length === 0) return alert("Adisyonunuz boÅŸ!");
            
            let mesaj = "ðŸ”” *YENÄ° SÄ°PARÄ°Åž*\n\n";
            let toplam = 0;
            sepet.forEach(u => {
                mesaj += `- ${u.ad} (${u.fiyat} â‚º)\n`;
                toplam += parseFloat(u.fiyat);
            });
            mesaj += `\n*TOPLAM:* ${toplam} â‚º`;
            
            window.open(`https://api.whatsapp.com/send?phone=905XXXXXXXXXX&text=${encodeURIComponent(mesaj)}`, '_blank');
            
            sepet = [];
            document.getElementById('cartCount').innerText = "0";
            sepetiKapat();
        }

        sistemiBaslat();
    </script>
</body>
</html>
