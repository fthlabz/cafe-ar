<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Cafe-AR | Elite</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600&family=Montserrat:wght@800&display=swap" rel="stylesheet">
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Inter', sans-serif; background: #0a0a0a; color: white; display: flex; flex-direction: column; height: 100vh; }
        .header { display: flex; flex-direction: column; align-items: center; padding: 20px; background: rgba(10, 10, 10, 0.95); border-bottom: 1px solid #d4af3733; }
        .brand { font-family: 'Playfair Display', serif; font-size: 24px; color: #d4af37; text-transform: uppercase; }
        .ar-container { flex: 1; position: relative; background: #111; }
        model-viewer { width: 100%; height: 100%; outline: none; --poster-color: transparent; }
        .btn-ar { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #d4af37 0%, #aa8c2c 100%); color: black; font-weight: 800; padding: 18px 40px; border-radius: 16px; border: none; cursor: pointer; white-space: nowrap; }
        #loader { position: absolute; top:0; left:0; width:100%; height:100%; background: #0a0a0a; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; }
        .spinner { width: 40px; height: 40px; border: 3px solid #333; border-top: 3px solid #d4af37; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="loader"><div class="spinner"></div></div>
    <div class="header"><div class="brand" id="tepeRestoranAdi">YÜKLENİYOR...</div></div>
    <div class="ar-container">
        <model-viewer id="ar-gosterici"
            src="https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/BoxTextured/glTF-Binary/BoxTextured.glb"
            ar ar-modes="webxr scene-viewer quick-look"
            camera-controls
            disable-zoom
            camera-orbit="0deg 90deg 2m"
            camera-target="0m 0.75m 0m"
            ar-placement="floor"
            scale="1 1.5 0.05"
            shadow-intensity="2">
            <button slot="ar-button" style="display: none;"></button>
            <button class="btn-ar" onclick="document.getElementById('ar-gosterici').activateAR()">AR MENÜYÜ AÇ</button>
        </model-viewer>
    </div>
<script>
    const KULLANICI = "fthlabz"; const REPO = "cafe-ar";
    let isletmeAdi = "THE RESTAURANT";

    async function sistemiBaslat() {
        try {
            const a = await fetch(`https://raw.githubusercontent.com/${KULLANICI}/${REPO}/main/ayarlar.json?t=${Date.now()}`);
            if (a.ok) { const ayar = await a.json(); isletmeAdi = ayar.restoranAdi || isletmeAdi; }
            document.getElementById('tepeRestoranAdi').innerText = isletmeAdi;

            const url = new URLSearchParams(window.location.search);
            const kat = url.get('kategori') || 'Tümü';
            const c = await fetch(`https://raw.githubusercontent.com/${KULLANICI}/${REPO}/main/menu.json?t=${Date.now()}`);
            if (c.ok) {
                let d = await c.json();
                if(kat !== 'Tümü') d = d.filter(u => u.kategori === kat);
                await arMenuCiz(d, kat);
            }
        } catch (e) {}
        document.getElementById('loader').style.opacity = '0';
        setTimeout(() => document.getElementById('loader').style.display = 'none', 500);
    }

    async function arMenuCiz(veriler, kat) {
        const canvas = document.createElement('canvas'); canvas.width = 1200; canvas.height = 1800;
        const ctx = canvas.getContext('2d');
        // AYNA DÜZELTME
        ctx.translate(canvas.width, 0); ctx.scale(-1, 1);
        
        const grd = ctx.createLinearGradient(0, 0, 0, 1800); grd.addColorStop(0, "#1a1a1a"); grd.addColorStop(1, "#050505");
        ctx.fillStyle = grd; ctx.fillRect(0, 0, 1200, 1800);
        ctx.strokeStyle = '#d4af37'; ctx.lineWidth = 10; ctx.strokeRect(40, 40, 1120, 1720);
        
        ctx.fillStyle = '#d4af37'; ctx.font = 'bold 70px Playfair Display'; ctx.textAlign = 'center';
        ctx.fillText(isletmeAdi, 600, 160);
        ctx.font = '30px Montserrat'; ctx.fillText(kat.toUpperCase(), 600, 220);

        let y = 350;
        const spacing = Math.max(250, 1400 / (veriler.length || 1));
        for (const u of veriler) {
            if (u.resim) { 
                const img = await new Promise(r => { const i = new Image(); i.crossOrigin="anonymous"; i.onload=()=>r(i); i.src=u.resim; });
                ctx.drawImage(img, 100, y, 180, 180);
            }
            ctx.textAlign = 'left'; ctx.fillStyle = '#d4af37'; ctx.font = 'bold 45px Playfair Display';
            ctx.fillText(u.ad, 320, y + 60);
            ctx.fillStyle = '#fff'; ctx.font = 'bold 50px Inter'; ctx.textAlign = 'right';
            ctx.fillText(u.fiyat + ' ₺', 1100, y + 60);
            
            ctx.textAlign = 'left'; ctx.fillStyle = '#aaa'; ctx.font = '28px Inter';
            const words = (u.icerik || "").split(' '); let line = '';
            let ty = y + 120;
            for(let n=0; n<words.length; n++) {
                if (ctx.measureText(line + words[n]).width > 700) { ctx.fillText(line, 320, ty); line = words[n] + ' '; ty += 40; }
                else line += words[n] + ' ';
            }
            ctx.fillText(line, 320, ty);
            y += spacing;
        }
        ctx.fillStyle = '#666'; ctx.font = 'bold 30px Montserrat'; ctx.textAlign = 'center';
        ctx.fillText('POWERED BY FTHLABZ', 600, 1760);

        const mv = document.getElementById('ar-gosterici');
        if (mv.model) {
            const tex = await mv.createTexture(canvas.toDataURL('image/jpeg', 0.9));
            mv.model.materials[0].pbrMetallicRoughness.baseColorTexture.setTexture(tex);
        }
    }
    sistemiBaslat();
</script>
</body>
</html>
