<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cafe-AR | Y√∂netim Paneli</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root { --bg-dark: #0f0f11; --card-glass: rgba(25, 25, 25, 0.9); --accent: #d4af37; --text-main: #ffffff; --text-muted: #a1a1aa; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: #0f0f11; color: var(--text-main); min-height: 100vh; padding: 20px; }
        .container { max-width: 550px; margin: 0 auto; padding-bottom: 50px; }
        header { text-align: center; margin-bottom: 30px; }
        h2 { font-weight: 800; font-size: 24px; margin: 0; color: var(--accent); letter-spacing: 1px; }
        .glass-card { background: var(--card-glass); border-radius: 20px; border: 1px solid rgba(212, 175, 55, 0.2); padding: 25px; margin-bottom: 20px; }
        
        .upload-area { position: relative; width: 100%; height: 160px; border: 2px dashed rgba(212, 175, 55, 0.4); border-radius: 16px; display: flex; align-items: center; justify-content: center; flex-direction: column; cursor: pointer; background: rgba(0,0,0,0.5); overflow: hidden; margin-bottom: 15px; }
        .upload-area input { position: absolute; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 2; }
        #previewImg { position: absolute; top:0; left:0; width:100%; height:100%; object-fit: cover; opacity: 0.8; z-index: 1; display: none; }
        
        input, select { background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 15px; border-radius: 12px; font-size: 14px; width: 100%; box-sizing: border-box; margin-bottom: 12px; outline: none; transition: 0.3s;}
        input:focus, select:focus { border-color: var(--accent); }
        select option { background: #111; }
        
        .btn-main { background: var(--accent); color: #000; border: none; padding: 16px; border-radius: 12px; font-weight: 800; cursor: pointer; width: 100%; font-size: 15px; margin-top: 10px; transition: 0.2s;}
        .btn-main:active { transform: scale(0.97); }
        
        .list-item { display: flex; align-items: center; background: rgba(0,0,0,0.4); padding: 15px; border-radius: 14px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.05); }
        .thumb { width: 60px; height: 60px; border-radius: 10px; object-fit: cover; margin-right: 15px; border: 1px solid var(--accent); }
        .info { flex: 1; }
        .info h4 { margin: 0 0 5px 0; font-size: 15px; color: var(--accent); }
        .info p { margin: 0; font-size: 12px; color: var(--text-muted); line-height: 1.4; }
        .fiyat { font-weight: bold; color: white; font-size: 14px; margin-top: 5px; }
        
        .btn-action { background: rgba(255,255,255,0.1); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; margin-left: 5px; }
        .btn-del { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        
        .qr-link-box { background: rgba(212,175,55,0.1); border: 1px dashed var(--accent); padding: 10px; border-radius: 10px; margin-bottom: 15px; font-size: 12px; color: #ccc; word-break: break-all; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2>THE RESTAURANT</h2>
        <div style="color:var(--text-muted); font-size: 13px; margin-top:5px;">Elit Men√º Y√∂netimi</div>
    </header>

    <div class="glass-card">
        <div class="upload-area">
            <span id="upText" style="color:var(--accent); font-weight:bold;">üì∏ √úr√ºn G√∂rseli Se√ß</span>
            <img id="previewImg">
            <input type="file" id="fileInput" accept="image/*" onchange="gorselSec(this)">
        </div>

        <select id="kategori">
            <option value="AnaYemekler">Ana Yemekler</option>
            <option value="Baslangiclar">Ba≈ülangƒ±√ßlar</option>
            <option value="Tatlilar">Tatlƒ±lar</option>
            <option value="SicakIcecekler">Sƒ±cak ƒ∞√ßecekler</option>
            <option value="SogukIcecekler">Soƒüuk ƒ∞√ßecekler</option>
        </select>
        
        <input type="text" id="urunAdi" placeholder="Yemek Adƒ± (√ñrn: Dana Lokum)" required>
        <input type="text" id="icerik" placeholder="ƒ∞√ßindekiler (√ñrn: Tr√ºf mantarƒ±, bebek patates)" required>
        
        <div style="display: flex; gap: 10px;">
            <input type="text" id="kalori" placeholder="Kalori (√ñrn: 450 kcal)" required>
            <input type="text" id="fiyat" placeholder="Fiyat (√ñrn: 850)" required>
        </div>
        
        <button class="btn-main" onclick="menuyeEkle()">MEN√úYE EKLE</button>
        <div id="statusText" style="text-align:center; color:var(--accent); display:none; margin-top:10px; font-size:13px;">ƒ∞≈üleniyor...</div>
    </div>

    <div class="glass-card" style="padding: 15px;">
        <h3 style="margin: 0 0 15px 0; font-size: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">Yayƒ±ndaki Men√º (<span id="count">0</span>)</h3>
        
        <div class="qr-link-box">
            M√º≈üterilere vereceƒüiniz √∂rnek link yapƒ±sƒ±:<br>
            <strong style="color:var(--accent);">https://fthlabz.github.io/cafe-ar/index.html?kategori=Tatlilar</strong>
        </div>

        <div id="menuListesi"></div>
    </div>
</div>

<script>
    // GitHub Ayarlarƒ±
    const KULLANICI = "fthlabz"; 
    const REPO = "cafe-ar"; 
    const sifreliKasa = "U2FsdGVkX19mc0X7xpzonbEzWQgJl2dp+4Oqrqhg6zeA49eOwhvOSgJsBs2IQkLhw61Ilvvd6nS1CVjkJ+0bnA=="; 
    const gizliPin = "1453"; 
    const githubToken = CryptoJS.AES.decrypt(sifreliKasa, gizliPin).toString(CryptoJS.enc.Utf8); 

    let menu = [];

    function gorselSec(input) {
        if (input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('previewImg').style.display = 'block';
                document.getElementById('upText').style.display = 'none';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    async function sistemiBaslat() {
        try {
            const cevap = await fetch(`https://raw.githubusercontent.com/${KULLANICI}/${REPO}/main/menu.json?t=${Date.now()}`);
            if (cevap.ok) { menu = await cevap.json(); listeyiCiz(); }
        } catch (e) { console.log("Men√º olu≈üturulacak."); }
    }
    sistemiBaslat();

    async function menuyeEkle() {
        const file = document.getElementById('fileInput').files[0];
        const ad = document.getElementById('urunAdi').value;
        const icerik = document.getElementById('icerik').value;
        const kalori = document.getElementById('kalori').value;
        const fiyat = document.getElementById('fiyat').value;
        const kategori = document.getElementById('kategori').value;

        if (!file || !ad || !fiyat) { alert("Resim, ƒ∞sim ve Fiyat zorunludur!"); return; }

        const st = document.getElementById('statusText');
        st.style.display = "block"; st.innerText = "G√∂rsel ƒ∞≈üleniyor... ‚è≥";

        const url = URL.createObjectURL(file);
        const img = new Image(); img.src = url;
        
        await new Promise(r => img.onload = r);
        const canvas = document.createElement('canvas');
        
        // Kare Kesim Optimizasyonu
        let size = Math.min(img.width, img.height);
        canvas.width = 600; canvas.height = 600;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, (img.width-size)/2, (img.height-size)/2, size, size, 0, 0, 600, 600);
        
        const base64Content = canvas.toDataURL('image/jpeg', 0.8).split(',')[1];
        const dosyaAdi = `yemek_${Date.now()}.jpg`;

        st.innerText = "Buluta Y√ºkleniyor... ‚òÅÔ∏è";

        try {
            const res = await fetch(`https://api.github.com/repos/${KULLANICI}/${REPO}/contents/images/${dosyaAdi}`, {
                method: 'PUT', headers: { 'Authorization': `token ${githubToken}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: "Yemek eklendi", content: base64Content })
            });

            if (res.ok) {
                const data = await res.json();
                menu.push({ 
                    id: Date.now(), ad: ad, icerik: icerik, kalori: kalori, fiyat: fiyat, 
                    kategori: kategori, resim: data.content.download_url 
                });
                await jsonKaydet();
                
                st.innerText = "Men√ºye Eklendi! ‚úÖ";
                setTimeout(() => st.style.display = 'none', 2000);
                listeyiCiz();
            }
        } catch (e) { alert("Baƒülantƒ± Hatasƒ±!"); }
    }

    function listeyiCiz() {
        const list = document.getElementById('menuListesi');
        document.getElementById('count').innerText = menu.length;
        list.innerHTML = "";
        
        // Men√ºy√º tersten dizelim (en son eklenen en √ºstte √ßƒ±ksƒ±n)
        [...menu].reverse().forEach(u => {
            list.innerHTML += `
                <div class="list-item">
                    <img src="${u.resim}" class="thumb">
                    <div class="info">
                        <h4>${u.ad}</h4>
                        <p>${u.kategori} ‚Ä¢ ${u.kalori}</p>
                        <div class="fiyat">${u.fiyat} ‚Ç∫</div>
                    </div>
                    <div style="display:flex; flex-direction:column; gap:5px;">
                        <button class="btn-action" onclick="fiyatGuncelle(${u.id})">‚úèÔ∏è Fiyat</button>
                        <button class="btn-action btn-del" onclick="sil(${u.id})">üóëÔ∏è Sil</button>
                    </div>
                </div>`;
        });
    }

    async function fiyatGuncelle(id) {
        const urun = menu.find(m => m.id === id);
        const yeniFiyat = prompt(`${urun.ad} i√ßin yeni fiyatƒ± girin:`, urun.fiyat);
        if (yeniFiyat && yeniFiyat !== urun.fiyat) {
            urun.fiyat = yeniFiyat;
            await jsonKaydet();
            listeyiCiz();
        }
    }

    async function sil(id) {
        if (confirm("Bu √ºr√ºn√º men√ºden kaldƒ±rmak istediƒüinize emin misiniz?")) {
            menu = menu.filter(m => m.id !== id);
            await jsonKaydet(); listeyiCiz();
        }
    }

    async function jsonKaydet() {
        const url = `https://api.github.com/repos/${KULLANICI}/${REPO}/contents/menu.json`;
        let sha = "";
        try { const r = await fetch(url, { headers: { 'Authorization': `token ${githubToken}` } }); if(r.ok) sha = (await r.json()).sha; } catch(e){}
        await fetch(url, { method: 'PUT', headers: { 'Authorization': `token ${githubToken}`, 'Content-Type': 'application/json' }, body: JSON.stringify({ message: "Menu guncellendi", content: btoa(unescape(encodeURIComponent(JSON.stringify(menu)))), sha: sha || undefined }) });
    }
</script>
</body>
</html>
