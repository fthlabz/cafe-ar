<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cafe-AR | Y√∂netim Terminali</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root { --bg-dark: #121212; --card-glass: rgba(25, 25, 25, 0.8); --input-bg: rgba(255, 255, 255, 0.05); --accent: #f59e0b; --text-main: #ffffff; --text-muted: #a1a1aa; --danger: #ef4444; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: radial-gradient(circle at 50% 0%, #2a2a2a 0%, var(--bg-dark) 80%); color: var(--text-main); min-height: 100vh; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; padding-bottom: 50px; }
        header { text-align: center; margin-bottom: 30px; }
        h2 { font-weight: 800; font-size: 24px; margin: 0; color: var(--accent); }
        .glass-card { background: var(--card-glass); backdrop-filter: blur(20px); border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); padding: 25px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        .upload-area { position: relative; width: 100%; height: 160px; border: 2px dashed rgba(245, 158, 11, 0.3); border-radius: 16px; display: flex; align-items: center; justify-content: center; flex-direction: column; cursor: pointer; background: rgba(0,0,0,0.2); overflow: hidden; margin-bottom: 15px; transition: 0.3s; }
        .upload-area:hover { border-color: var(--accent); background: rgba(245, 158, 11, 0.05); }
        .upload-area input { position: absolute; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 2; }
        #previewImg { position: absolute; top:0; left:0; width:100%; height:100%; object-fit: cover; opacity: 0.7; z-index: 1; display: none; }
        .upload-text { font-size: 14px; color: var(--text-muted); font-weight: 500; z-index: 1;}
        
        input, select { background: var(--input-bg); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 15px; border-radius: 12px; font-size: 14px; width: 100%; box-sizing: border-box; margin-bottom: 12px; outline: none; }
        input:focus, select:focus { border-color: var(--accent); }
        
        .btn-main { background: var(--accent); color: #000; border: none; padding: 16px; border-radius: 12px; font-weight: 800; cursor: pointer; width: 100%; font-size: 15px; margin-top: 5px; }
        .btn-main:active { transform: scale(0.97); }
        
        .list-item { display: flex; align-items: center; background: rgba(255,255,255,0.03); padding: 10px; border-radius: 14px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.05); }
        .thumb { width: 50px; height: 50px; border-radius: 10px; object-fit: cover; margin-right: 15px; }
        .info { flex: 1; }
        .info h4 { margin: 0 0 3px 0; font-size: 14px; }
        .info p { margin: 0; font-size: 12px; color: var(--text-muted); }
        .btn-del { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: none; width: 35px; height: 35px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        #statusText { text-align: center; color: var(--accent); font-size: 13px; margin-top: 10px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2>CAFE-AR PANEL</h2>
        <div style="color:var(--text-muted); font-size: 13px;">Dinamik Men√º Y√∂netimi</div>
    </header>

    <div class="glass-card">
        <div class="upload-area">
            <span class="upload-text" id="upText">üì∏ √úr√ºn G√∂rseli Se√ß</span>
            <img id="previewImg">
            <input type="file" id="fileInput" accept="image/*" onchange="gorselSec(this)">
        </div>

        <select id="kategori">
            <option value="Burgerler">üçî Burgerler</option>
            <option value="Pizzalar">üçï Pizzalar</option>
            <option value="ƒ∞√ßecekler">ü•§ ƒ∞√ßecekler</option>
            <option value="Tatlƒ±lar">üç∞ Tatlƒ±lar</option>
        </select>
        
        <input type="text" id="urunAdi" placeholder="Yemek Adƒ± (√ñrn: Truffle Burger)" required>
        <input type="text" id="fiyat" placeholder="Fiyat (√ñrn: 350)" required>
        
        <button class="btn-main" onclick="menuyeEkle()">MEN√úYE EKLE</button>
        <div id="statusText">ƒ∞≈üleniyor...</div>
    </div>

    <div class="glass-card" style="padding: 15px;">
        <h3 style="margin: 0 0 15px 0; font-size: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">Yayƒ±ndaki Men√º (<span id="count">0</span>)</h3>
        <div id="menuListesi"></div>
    </div>
</div>

<script>
    const KULLANICI = "fthlabz"; 
    const REPO = "cafe-ar"; 
    const sifreliKasa = "U2FsdGVkX19mc0X7xpzonbEzWQgJl2dp+4Oqrqhg6zeA49eOwhvOSgJsBs2IQkLhw61Ilvvd6nS1CVjkJ+0bnA=="; 
    const gizliPin = "1453"; 
    const githubToken = CryptoJS.AES.decrypt(sifreliKasa, gizliPin).toString(CryptoJS.enc.Utf8); 

    let menu = [];

    function gorselSec(input) {
        if (input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('previewImg').style.display = 'block';
                document.getElementById('upText').style.display = 'none';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    async function sistemiBaslat() {
        try {
            const cevap = await fetch(`https://raw.githubusercontent.com/${KULLANICI}/${REPO}/main/menu.json?t=${Date.now()}`);
            if (cevap.ok) { menu = await cevap.json(); listeyiCiz(); }
        } catch (e) { console.log("Men√º yeni olu≈üturulacak."); }
    }
    sistemiBaslat();

    async function menuyeEkle() {
        const file = document.getElementById('fileInput').files[0];
        const ad = document.getElementById('urunAdi').value;
        const fiyat = document.getElementById('fiyat').value;
        const kategori = document.getElementById('kategori').value;

        if (!file || !ad || !fiyat) { alert("L√ºtfen t√ºm alanlarƒ± doldurun."); return; }

        const st = document.getElementById('statusText');
        st.style.display = "block"; st.innerText = "G√∂rsel ƒ∞≈üleniyor... ‚è≥";

        const url = URL.createObjectURL(file);
        const img = new Image(); img.src = url;
        
        await new Promise(r => img.onload = r);
        const canvas = document.createElement('canvas');
        let w = img.width, h = img.height;
        if(w > 800 || h > 800) { if(w>h){h*=800/w; w=800;} else{w*=800/h; h=800;} }
        canvas.width = w; canvas.height = h;
        canvas.getContext('2d').drawImage(img, 0, 0, w, h);
        
        const base64Content = canvas.toDataURL('image/jpeg', 0.8).split(',')[1];
        const dosyaAdi = `yemek_${Date.now()}.jpg`;

        st.innerText = "Buluta Y√ºkleniyor... ‚òÅÔ∏è";

        try {
            const res = await fetch(`https://api.github.com/repos/${KULLANICI}/${REPO}/contents/images/${dosyaAdi}`, {
                method: 'PUT', headers: { 'Authorization': `token ${githubToken}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: "Yemek eklendi", content: base64Content })
            });

            if (res.ok) {
                const data = await res.json();
                menu.push({ id: Date.now(), ad: ad, fiyat: fiyat, kategori: kategori, resim: data.content.download_url });
                await jsonKaydet();
                st.innerText = "Ba≈üarƒ±yla Eklendi! ‚úÖ";
                setTimeout(() => st.style.display = 'none', 2000);
                listeyiCiz();
            }
        } catch (e) { alert("Baƒülantƒ± Hatasƒ±!"); }
    }

    function listeyiCiz() {
        const list = document.getElementById('menuListesi');
        document.getElementById('count').innerText = menu.length;
        list.innerHTML = "";
        menu.forEach(u => {
            list.innerHTML += `
                <div class="list-item">
                    <img src="${u.resim}" class="thumb">
                    <div class="info">
                        <h4>${u.ad}</h4><p>${u.kategori} ‚Ä¢ ${u.fiyat} ‚Ç∫</p>
                    </div>
                    <button class="btn-del" onclick="sil(${u.id})">X</button>
                </div>`;
        });
    }

    async function sil(id) {
        if (confirm("Silmek istediƒüinize emin misiniz?")) {
            menu = menu.filter(m => m.id !== id);
            await jsonKaydet(); listeyiCiz();
        }
    }

    async function jsonKaydet() {
        const url = `https://api.github.com/repos/${KULLANICI}/${REPO}/contents/menu.json`;
        let sha = "";
        try { const r = await fetch(url, { headers: { 'Authorization': `token ${githubToken}` } }); if(r.ok) sha = (await r.json()).sha; } catch(e){}
        await fetch(url, { method: 'PUT', headers: { 'Authorization': `token ${githubToken}`, 'Content-Type': 'application/json' }, body: JSON.stringify({ message: "Menu guncellendi", content: btoa(unescape(encodeURIComponent(JSON.stringify(menu)))), sha: sha || undefined }) });
    }
</script>
</body>
</html>
